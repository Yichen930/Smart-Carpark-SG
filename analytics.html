<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Carpark Analytics & Trends - Smart Carpark SG</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#137fec",
                    "background-light": "#f6f7f8",
                    "background-dark": "#101922",
                },
                fontFamily: {
                    "display": ["Public Sans"]
                },
                borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
            },
        },
    }
</script>
<style>
    .material-symbols-outlined {
        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    ::-webkit-scrollbar {
        width: 4px;
    }
    ::-webkit-scrollbar-thumb {
        background: #3b4754;
        border-radius: 10px;
    }
    body {
        min-height: max(884px, 100dvh);
    }
</style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-slate-900 dark:text-white transition-colors duration-300">
<div class="relative flex h-screen w-full flex-col overflow-x-hidden">
<!-- Top App Bar -->
<header class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800">
    <div class="flex items-center p-4 justify-between max-w-lg mx-auto w-full">
        <div class="flex size-10 shrink-0 items-center justify-start">
            <button onclick="App.navigateTo('results.html')" class="cursor-pointer">
                <span class="material-symbols-outlined">arrow_back_ios</span>
            </button>
        </div>
        <h2 class="text-lg font-bold leading-tight tracking-tight flex-1 text-center">Carpark Analytics</h2>
        <div class="flex size-10 items-center justify-end">
            <span class="material-symbols-outlined cursor-pointer">more_horiz</span>
        </div>
    </div>
</header>

<!-- Main Scrollable Content -->
<main class="flex-1 overflow-y-auto pb-24">
<div class="max-w-lg mx-auto w-full">
<!-- Filters Section -->
<div class="p-4 space-y-4">
    <div class="flex flex-col gap-2">
        <label class="text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 px-1">Location</label>
        <div class="relative">
            <select id="carparkSelect" class="form-input block w-full appearance-none rounded-xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900/50 py-3 pl-11 pr-10 text-base focus:border-primary focus:ring-primary">
                <option value="0">Orchard Central Carpark</option>
                <option value="1">313@Somerset Parking</option>
                <option value="2">Marina Bay Sands Carpark</option>
                <option value="3">VivoCity Carpark</option>
                <option value="4">HDB Clementi Block 445</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <span class="material-symbols-outlined text-primary">location_on</span>
            </div>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
                <span class="material-symbols-outlined text-slate-400">expand_more</span>
            </div>
        </div>
    </div>
    <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
        <button data-period="today" class="period-btn whitespace-nowrap rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white">Today</button>
        <button data-period="week" class="period-btn whitespace-nowrap rounded-full bg-slate-200 dark:bg-slate-800 px-4 py-2 text-sm font-medium">Last 7 Days</button>
        <button data-period="month" class="period-btn whitespace-nowrap rounded-full bg-slate-200 dark:bg-slate-800 px-4 py-2 text-sm font-medium">Last 30 Days</button>
    </div>
</div>

<!-- KPI Cards -->
<div class="grid grid-cols-2 gap-4 px-4">
    <div class="flex flex-col gap-1 rounded-xl bg-white dark:bg-slate-900/40 p-5 border border-slate-100 dark:border-slate-800 shadow-sm">
        <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-primary text-xl">trending_up</span>
            <p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase">Peak Occupancy</p>
        </div>
        <div class="flex items-baseline gap-2 mt-2">
            <p id="peakOccupancy" class="text-2xl font-bold">92%</p>
            <p class="text-emerald-500 text-xs font-bold">+5.2%</p>
        </div>
    </div>
    <div class="flex flex-col gap-1 rounded-xl bg-white dark:bg-slate-900/40 p-5 border border-slate-100 dark:border-slate-800 shadow-sm">
        <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-primary text-xl">event_seat</span>
            <p class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase">Avg. Lots</p>
        </div>
        <div class="flex items-baseline gap-2 mt-2">
            <p id="avgLots" class="text-2xl font-bold">45</p>
            <p class="text-rose-500 text-xs font-bold">-2.1%</p>
        </div>
    </div>
</div>

<!-- Histogram: Hourly Availability -->
<section class="mt-8 px-4">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold">Hourly Availability</h3>
        <span class="material-symbols-outlined text-slate-400 cursor-pointer">info</span>
    </div>
    <div class="rounded-xl bg-white dark:bg-slate-900/40 p-4 border border-slate-100 dark:border-slate-800 shadow-sm">
        <div id="histogramChart" class="flex items-end justify-between h-48 gap-1 mb-2">
            <!-- Histogram bars will be generated by JS -->
        </div>
        <div class="flex justify-between text-[10px] font-bold text-slate-500 uppercase tracking-tighter">
            <span>12am</span>
            <span>6am</span>
            <span>12pm</span>
            <span>6pm</span>
            <span>12am</span>
        </div>
    </div>
    <div class="mt-4 flex items-start gap-3 rounded-lg bg-primary/10 p-3 border border-primary/20">
        <span class="material-symbols-outlined text-primary">lightbulb</span>
        <p class="text-sm leading-snug">
            <span class="font-bold">Pro-tip:</span> This carpark is usually at peak capacity between <span class="font-bold">12:30 PM and 2:00 PM</span>. Try arriving before 11 AM.
        </p>
    </div>
</section>

<!-- Line Chart: Weekly Trends -->
<section class="mt-8 px-4 pb-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold">Weekly Trends</h3>
    </div>
    <div class="relative rounded-xl bg-white dark:bg-slate-900/40 p-4 border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden">
        <div class="h-40 w-full relative">
            <svg id="lineChart" class="w-full h-full overflow-visible" viewBox="0 0 400 100">
                <!-- Line chart will be generated by JS -->
            </svg>
            <!-- Grid lines -->
            <div class="absolute inset-0 flex flex-col justify-between opacity-10 pointer-events-none">
                <div class="w-full border-t border-slate-900 dark:border-white"></div>
                <div class="w-full border-t border-slate-900 dark:border-white"></div>
                <div class="w-full border-t border-slate-900 dark:border-white"></div>
            </div>
        </div>
        <div class="flex justify-between text-[10px] font-bold text-slate-500 uppercase mt-4">
            <span>Mon</span>
            <span>Tue</span>
            <span>Wed</span>
            <span>Thu</span>
            <span>Fri</span>
            <span>Sat</span>
            <span>Sun</span>
        </div>
    </div>
</section>
</div>
</main>

<!-- iOS Bottom Tab Bar -->
<nav class="fixed bottom-0 z-50 w-full bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-lg border-t border-slate-200 dark:border-slate-800 pb-safe">
    <div class="max-w-lg mx-auto flex h-16 items-center justify-around px-4">
        <button onclick="App.navigateTo('results.html')" class="flex flex-col items-center justify-center text-slate-400">
            <span class="material-symbols-outlined">map</span>
            <span class="text-[10px] font-medium mt-1">Explore</span>
        </button>
        <button data-page="analytics.html" class="flex flex-col items-center justify-center text-primary">
            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">insights</span>
            <span class="text-[10px] font-medium mt-1">Analytics</span>
        </button>
    </div>
</nav>
</div>

<script src="js/app.js"></script>
<script src="js/mockData.js"></script>
<script>
    let selectedCarparkIndex = 0;
    let selectedPeriod = 'today';
    
    function renderHistogram() {
        const chartEl = document.getElementById('histogramChart');
        const data = mockAnalytics.hourly;
        const maxValue = Math.max(...data.map(d => d.available), 1);
        
        chartEl.innerHTML = '';
        
        data.forEach((point, index) => {
            const height = maxValue ? (point.available / maxValue) * 100 : 0;
            const opacity = height > 80 ? 1 : height > 60 ? 0.8 : height > 40 ? 0.6 : height > 20 ? 0.4 : 0.2;
            
            const bar = document.createElement('div');
            bar.className = 'flex-1 bg-primary rounded-t-sm';
            bar.style.minHeight = '4px';
            bar.style.height = `${height}%`;
            bar.style.opacity = opacity;
            chartEl.appendChild(bar);
        });
    }
    
    function renderLineChart() {
        const svg = document.getElementById('lineChart');
        const data = mockAnalytics.weekly;
        const maxValue = Math.max(...data.map(d => d.available), 1);
        const width = 400;
        const height = 100;
        const padding = 20;
        const chartWidth = width - (padding * 2);
        const chartHeight = height - (padding * 2);
        
        // Clear previous
        svg.innerHTML = '';
        
        // Create path
        let pathData = '';
        data.forEach((point, index) => {
            const x = padding + (index / (data.length - 1)) * chartWidth;
            const y = padding + chartHeight - (point.available / maxValue) * chartHeight;
            
            if (index === 0) {
                pathData += `M ${x} ${y}`;
            } else {
                pathData += ` L ${x} ${y}`;
            }
        });
        
        // Draw path
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', pathData);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', '#137fec');
        path.setAttribute('stroke-width', '3');
        svg.appendChild(path);
        
        // Draw points
        data.forEach((point, index) => {
            const x = padding + (index / (data.length - 1)) * chartWidth;
            const y = padding + chartHeight - (point.available / maxValue) * chartHeight;
            
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', x);
            circle.setAttribute('cy', y);
            circle.setAttribute('r', '4');
            circle.setAttribute('fill', '#137fec');
            svg.appendChild(circle);
        });
    }
    
    function updateKPIs() {
        const carpark = mockCarparks[selectedCarparkIndex];
        const peakOccupancy = Math.round((1 - carpark.availableLots / carpark.lotCount) * 100);
        document.getElementById('peakOccupancy').textContent = `${peakOccupancy}%`;
        document.getElementById('avgLots').textContent = Math.round(carpark.availableLots);
    }
    
    // Carpark selection
    document.getElementById('carparkSelect').addEventListener('change', function() {
        selectedCarparkIndex = parseInt(this.value);
        updateKPIs();
        renderHistogram();
        renderLineChart();
    });
    
    // Period selection
    document.querySelectorAll('.period-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.period-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'font-semibold');
                b.classList.add('bg-slate-200', 'dark:bg-slate-800', 'font-medium');
            });
            this.classList.add('bg-primary', 'text-white', 'font-semibold');
            this.classList.remove('bg-slate-200', 'dark:bg-slate-800', 'font-medium');
            
            selectedPeriod = this.dataset.period;
            renderHistogram();
            renderLineChart();
        });
    });
    
    // Initialize
    updateKPIs();
    renderHistogram();
    renderLineChart();
</script>
</body>
</html>
