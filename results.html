<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Parking Results - Smart Carpark SG</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#137fec",
                    "background-light": "#f6f7f8",
                    "background-dark": "#101922",
                },
                fontFamily: {
                    "display": ["Public Sans", "sans-serif"]
                },
                borderRadius: {
                    "DEFAULT": "0.25rem",
                    "lg": "0.5rem",
                    "xl": "0.75rem",
                    "full": "9999px"
                },
            },
        },
    }
</script>
<style>
    body {
        font-family: "Public Sans", sans-serif;
    }
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    body {
        min-height: max(884px, 100dvh);
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white transition-colors duration-300">
<div class="relative flex flex-col h-screen w-full max-w-md mx-auto overflow-hidden shadow-2xl border-x border-slate-200 dark:border-slate-800">
<!-- Top App Bar -->
<header class="sticky top-0 z-50 flex items-center bg-background-light dark:bg-background-dark p-4 border-b border-slate-200 dark:border-slate-800 justify-between">
    <div class="flex items-center gap-2">
        <button onclick="App.navigateTo('search.html')" class="flex items-center justify-center size-10 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined">arrow_back</span>
        </button>
        <h1 id="destinationTitle" class="text-lg font-bold leading-tight tracking-tight">Orchard Road</h1>
    </div>
    <div class="flex gap-2">
        <button onclick="App.navigateTo('search.html')" class="flex items-center justify-center size-10 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined">search</span>
        </button>
        <button class="flex items-center justify-center size-10 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined">tune</span>
        </button>
    </div>
</header>

<!-- Main Content (Map + List) -->
<main class="flex flex-col flex-1 overflow-hidden">
<!-- Map Section (Fixed Height) -->
<section class="relative h-2/5 shrink-0">
    <div class="w-full h-full bg-slate-300 dark:bg-slate-700 relative overflow-hidden">
        <!-- Map Placeholder -->
        <div class="absolute inset-0 bg-center bg-cover" data-alt="Singapore dark mode city map view" data-location="Singapore" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDV_nvJUcilLMRKtCKBbAiNO3lBVGvtz6R5I6bOPpB6mVieYsZYil4_j8ePlNlKd79lJqGK2iecwgz7uSKPOYyaS076hHM6CIsGmbaJKSjaYfSKQ-1-rZpOzAxfZuK1ZCHHn0n0D5Izw73PtzSrr278aiNZcw6cufE_EDpWfl_o_9E9PqJZuIf_rr4J0wmUsQxvpf7nTTZWkx3D-QtiF4osQtiLmqFNlx5LI-icaDPWRGk26lwdNwxw0CiO8H84wMZH8CBjsb8tz0lE");'></div>
        <!-- Map Markers will be generated by JS -->
        <div id="mapMarkers"></div>
        <!-- Floating Action Buttons on Map -->
        <div class="absolute bottom-4 right-4 flex flex-col gap-2">
            <button class="flex items-center justify-center size-10 rounded-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-white shadow-lg">
                <span class="material-symbols-outlined">my_location</span>
            </button>
            <button class="flex items-center justify-center size-10 rounded-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-white shadow-lg">
                <span class="material-symbols-outlined">layers</span>
            </button>
        </div>
    </div>
</section>

<!-- Sticky Sort Controls -->
<div class="bg-background-light dark:bg-background-dark border-y border-slate-200 dark:border-slate-800 px-4 py-3 flex gap-2 overflow-x-auto hide-scrollbar z-20">
    <button data-sort="distance" class="sort-btn flex h-9 shrink-0 items-center justify-center gap-2 rounded-full bg-primary text-white px-4 text-sm font-semibold">
        <span class="material-symbols-outlined text-sm">near_me</span> Distance
        <span class="material-symbols-outlined text-sm">expand_more</span>
    </button>
    <button data-sort="availability" class="sort-btn flex h-9 shrink-0 items-center justify-center gap-2 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-4 text-sm font-semibold">
        Availability
        <span class="material-symbols-outlined text-sm">expand_more</span>
    </button>
    <button data-sort="cost" class="sort-btn flex h-9 shrink-0 items-center justify-center gap-2 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-4 text-sm font-semibold">
        Cost
        <span class="material-symbols-outlined text-sm">expand_more</span>
    </button>
    <button data-sort="recommendation" class="sort-btn flex h-9 shrink-0 items-center justify-center gap-2 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 px-4 text-sm font-semibold">
        Recommendation
        <span class="material-symbols-outlined text-sm">expand_more</span>
    </button>
</div>

<!-- Scrollable Results List -->
<section id="resultsList" class="flex-1 overflow-y-auto p-4 space-y-4 bg-background-light dark:bg-background-dark">
    <!-- Results will be generated by JS -->
</section>
</main>

<!-- Bottom Navigation Bar (iOS Style) -->
<nav class="bg-background-light dark:bg-background-dark border-t border-slate-200 dark:border-slate-800 px-6 py-2 flex justify-between items-center shrink-0">
    <button data-page="results.html" class="flex flex-col items-center gap-1 text-primary">
        <span class="material-symbols-outlined">map</span>
        <span class="text-[10px] font-bold">Explore</span>
    </button>
    <button onclick="App.navigateTo('analytics.html')" class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">analytics</span>
        <span class="text-[10px] font-bold">Trends</span>
    </button>
    <button class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">bookmarks</span>
        <span class="text-[10px] font-bold">Saved</span>
    </button>
    <button class="flex flex-col items-center gap-1 text-slate-400 hover:text-primary transition-colors">
        <span class="material-symbols-outlined">person</span>
        <span class="text-[10px] font-bold">Profile</span>
    </button>
</nav>

<!-- iOS Home Indicator -->
<div class="bg-background-light dark:bg-background-dark flex justify-center pb-1">
    <div class="w-32 h-1 bg-slate-300 dark:bg-slate-800 rounded-full mt-2 mb-1"></div>
</div>
</div>

<script src="js/app.js"></script>
<script src="js/mockData.js"></script>
<script>
    let currentSort = 'distance';
    let displayedCarparks = [];
    
    // Load search parameters
    const searchData = JSON.parse(sessionStorage.getItem('searchFilters') || '{}');
    const destination = searchData.destination || 'Orchard Road';
    const radius = searchData.radius || 1.0;
    const filters = searchData.filters || {};
    
    // Update title
    document.getElementById('destinationTitle').textContent = destination;
    
    // Filter and sort carparks
    function loadResults() {
        displayedCarparks = filterCarparks(filters, radius);
        
        if (displayedCarparks.length === 0) {
            document.getElementById('resultsList').innerHTML = `
                <div class="text-center py-12">
                    <span class="material-symbols-outlined text-6xl text-slate-400 mb-4">location_off</span>
                    <h3 class="text-xl font-bold mb-2">No carparks found</h3>
                    <p class="text-slate-500 mb-4">Try increasing your search radius or adjusting filters.</p>
                    <button onclick="App.navigateTo('search.html')" class="bg-primary text-white px-6 py-3 rounded-lg font-bold">
                        Modify Search
                    </button>
                </div>
            `;
            return;
        }
        
        displayedCarparks = sortCarparks(displayedCarparks, currentSort);
        renderResults();
        renderMapMarkers();
    }
    
    function renderResults() {
        const listEl = document.getElementById('resultsList');
        const count = displayedCarparks.length;
        
        listEl.innerHTML = `
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-sm font-bold uppercase tracking-wider text-slate-500">Top Recommendations</h2>
                <span class="text-xs text-primary font-bold">${count} location${count !== 1 ? 's' : ''} found</span>
            </div>
        `;
        
        displayedCarparks.forEach((carpark, index) => {
            const availabilityColor = getAvailabilityColor(carpark.availableLots, carpark.lotCount);
            const isRecommended = index === 0 && carpark.recommendationScore >= 8;
            
            const card = document.createElement('div');
            card.className = 'bg-white dark:bg-slate-900 rounded-xl overflow-hidden shadow-sm border border-slate-200 dark:border-slate-800 p-4 transition-transform active:scale-[0.98]';
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1">
                        <h3 class="text-lg font-bold leading-none mb-1">${carpark.name}</h3>
                        <div class="flex items-center gap-2 text-slate-500 text-sm">
                            <span class="material-symbols-outlined text-sm">directions_car</span>
                            <span>${formatDistance(carpark.distance)} away â€¢ ${carpark.type}</span>
                        </div>
                    </div>
                    ${isRecommended ? `
                    <div class="bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 px-2 py-1 rounded text-xs font-bold">
                        RECOMMENDED
                    </div>
                    ` : ''}
                </div>
                <div class="grid grid-cols-3 gap-2 py-3 border-y border-slate-100 dark:border-slate-800">
                    <div class="text-center">
                        <p class="text-xs text-slate-500 mb-0.5">Available</p>
                        <p class="text-sm font-bold text-${availabilityColor}-500">${carpark.availableLots}/${carpark.lotCount}</p>
                    </div>
                    <div class="text-center border-x border-slate-100 dark:border-slate-800">
                        <p class="text-xs text-slate-500 mb-0.5">Rate</p>
                        <p class="text-sm font-bold">${carpark.cost > 0 ? `S$${carpark.cost.toFixed(2)}/hr` : 'Free'}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-xs text-slate-500 mb-0.5">Weather</p>
                        <div class="flex items-center justify-center gap-1 text-amber-500">
                            <span class="material-symbols-outlined text-lg">wb_sunny</span>
                            <span class="text-sm font-bold">${carpark.weather}</span>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="flex items-center justify-between mb-1.5">
                        <span class="text-xs font-semibold text-slate-500">Smart Score</span>
                        <span class="text-xs font-bold text-primary">${carpark.recommendationScore.toFixed(1)}/10</span>
                    </div>
                    <div class="flex gap-1 h-1.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full overflow-hidden">
                        <div class="bg-primary rounded-full" style="width: ${(carpark.recommendationScore / 10) * 100}%"></div>
                    </div>
                </div>
                <div class="flex gap-2 mt-5">
                    <button onclick="selectCarpark(${carpark.id})" class="flex-1 bg-primary text-white font-bold h-11 rounded-lg hover:brightness-110 transition-all flex items-center justify-center gap-2">
                        Select
                    </button>
                    <button onclick="viewDetails(${carpark.id})" class="flex-1 border border-primary text-primary dark:border-primary/50 dark:text-primary font-bold h-11 rounded-lg hover:bg-primary/5 transition-all flex items-center justify-center gap-2">
                        View Details
                    </button>
                </div>
            `;
            listEl.appendChild(card);
        });
    }
    
    function renderMapMarkers() {
        const markersEl = document.getElementById('mapMarkers');
        markersEl.innerHTML = '';
        
        displayedCarparks.forEach((carpark, index) => {
            const availabilityColor = getAvailabilityColor(carpark.availableLots, carpark.lotCount);
            const colorMap = { emerald: 'emerald-500', amber: 'amber-500', rose: 'rose-500' };
            const color = colorMap[availabilityColor];
            
            // Position markers - special position for carpark with 45 lots (between Novena and Holland V)
            let pos;
            if (carpark.availableLots === 45) {
                // Position between Novena (north-central) and Holland Village (west-central)
                pos = { top: '80%', left: '47%' };
            } else {
                // Other positions for demo
                const positions = [
                    { top: '50%', left: '66%' },
                    { bottom: '25%', left: '50%' },
                    { top: '30%', left: '60%' },
                    { top: '60%', left: '30%' },
                    { top: '25%', left: '25%' }
                ];
                // Skip first position if it was used for the 45-lot marker
                const adjustedIndex = carpark.availableLots === 45 ? index + 1 : index;
                pos = positions[adjustedIndex % positions.length];
            }
            
            const marker = document.createElement('div');
            marker.className = `absolute ${pos.top ? `top-[${pos.top}]` : ''} ${pos.left ? `left-[${pos.left}]` : ''} ${pos.bottom ? `bottom-[${pos.bottom}]` : ''}`;
            marker.innerHTML = `
                <div class="relative group cursor-pointer ${index === 0 ? 'scale-110 ring-4 ring-primary/30 rounded-full' : ''}">
                    <div class="bg-${color} text-white rounded-full px-2 py-1 text-xs font-bold shadow-lg border-2 border-white dark:border-background-dark">${carpark.availableLots}</div>
                    <div class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-l-transparent border-r-transparent border-t-${color}"></div>
                </div>
            `;
            markersEl.appendChild(marker);
        });
    }
    
    function selectCarpark(id) {
        const carpark = mockCarparks.find(cp => cp.id === id);
        if (carpark) {
            sessionStorage.setItem('selectedCarpark', JSON.stringify(carpark));
            App.navigateTo('detail.html');
        }
    }
    
    function viewDetails(id) {
        selectCarpark(id);
    }
    
    // Sort functionality
    document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.sort-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white');
                b.classList.add('bg-slate-200', 'dark:bg-slate-800', 'text-slate-700', 'dark:text-slate-300');
            });
            this.classList.add('bg-primary', 'text-white');
            this.classList.remove('bg-slate-200', 'dark:bg-slate-800', 'text-slate-700', 'dark:text-slate-300');
            
            currentSort = this.dataset.sort;
            displayedCarparks = sortCarparks(displayedCarparks, currentSort);
            renderResults();
        });
    });
    
    // Initialize
    loadResults();
</script>
</body>
</html>
